#!/usr/bin/env python

#* vim: set filetype=python

import os
import argparse
from termcolor import colored
from subprocess import check_output

parser = argparse.ArgumentParser(description='Check the status of git repositories.')
parser.add_argument("paths", help="The path(s) to scan (recursively until it hits a .git directory)", nargs="+")
args = parser.parse_args()

for path in args.paths:
    for root, dirs, files in os.walk(path):
      if ".git" in dirs:
          os.chdir(root)
          if "working directory clean" in check_output(["git", "status"]):
              color = "green"
          else:
              color = "red"
          
          print "%-5s %-35s %s" % (colored(u"\u2717", color), os.getcwd().split('/')[-1], os.getcwd())

